# uc3-system-info

A tool for generating UC3 system info reports.

- [`cloud` command](#cloud-command)
- [`hosts` command](#hosts-command)
- [`nodes` command](#nodes-command)
- [Building](#building)

---

## `cloud` command

List Merritt cloud storage services.

> #### ⚠️ Note:
>
> The output from this command includes access keys and passwords for cloud storage services.
> Be careful where you copy or paste it! In the examples below, the keys and passwords are
> replaced with “••••••••”.

### Input

The path to a clone of the [mrt-conf-prv](github.com/cdlib/mrt-conf-prv/) private repository.

### Usage

```
Usage:
  uc3-system-info clouds <path to mrt-conf-prv> [flags]

Flags:
  -f, --format string   output format (tsv, csv, md) (default "tsv")
      --header          include header
      --footer          include footer
  -h, --help            help for clouds
```

### Examples

#### Generate a list in default TSV format, without header or footer

```
uc3-system-info clouds ~/Work/mrt-conf-prv
```

Outputs:

```
aws-near	s3	near-line			
aws-rr	s3	on-line			
aws-std	s3	on-line			
ch-unm-dev	cloudhost	on-line			
ch-unm-prd	cloudhost	on-line			
minio-sdsc	s3	on-line	https://cdl.qs3.sdsc.edu:443	••••••••	••••••••
sdsc	swift	on-line	https://cloud.sdsc.edu:443	••••••••	••••••••
ucla-dev	pairtree	on-line			
ucla-prod	pairtree	on-line			
ucla-stg	pairtree	on-line	
```

#### Generate a list in Markdown format with header and footer

```
uc3-sytem-info clouds ~/Work/mrt-conf-prv --format md --header --footer
```

Outputs:

> | Name | Service type | Access mode | Endpoint | Key | Secret |
> | :--- | :--- | :--- | :--- | :--- | :--- |
> | aws-near | s3 | near-line |  |  |  |
> | aws-rr | s3 | on-line |  |  |  |
> | aws-std | s3 | on-line |  |  |  |
> | ch-unm-dev | cloudhost | on-line |  |  |  |
> | ch-unm-prd | cloudhost | on-line |  |  |  |
> | minio-sdsc | s3 | on-line | https://cdl.qs3.sdsc.edu:443 | •••••••• | •••••••• |
> | sdsc | swift | on-line | https://cloud.sdsc.edu:443 | •••••••• | •••••••• |
> | ucla-dev | pairtree | on-line |  |  |  |
> | ucla-prod | pairtree | on-line |  |  |  |
> | ucla-stg | pairtree | on-line |  |  |  |

Generated 2019-02-15T14:14:52-08:00


---

## `hosts` command

List UC3 hosts.

### Input

An inventory file generated by `cnames_from_inv.sh` (see
[tests/testdata/uc3-inventory.txt](tests/testdata/uc3-inventory.txt) for an
example).

### Usage

```
Usage:
  uc3-system-info hosts <FILE> [flags]

Flags:
  -f, --format string    output format (tsv, csv, md) (default "tsv")
  -s, --service string   filter to specified service
      --header           include header
      --footer           include footer
  -h, --help             help for hosts
```

### Examples

#### Generate a full report in default TSV format, without header or footer

```
uc3-system-info hosts uc3-inventory.txt
```

Outputs:

```
dash    dev             uc3-dash2-dev   uc3-dash2-dev.cdlib.org dash-aws-dev.cdlib.org,dash-dev.cdlib.org,dash-ucla-dev.cdlib.org,dash2-crossref-dev.cdlib.org,dash2-dev.cdlib.org,datashare-dev.cdlib.org,oneshare-aws-dev.cdlib.org,oneshare-dev.cdlib.org,oneshare2-dev.cdlib.org,uc3-datashare-dev.cdlib.org
dash    dev     solr    uc3-dash2solr-dev       uc3-dash2solr-dev.cdlib.org     dash2solr-dev.cdlib.org
dash    stg             uc3-dash2-stg   uc3-dash2-stg.cdlib.org dash-stg.cdlib.org,dash-ucla-stg.cdlib.org,dash2-aws-stg.cdlib.org,dash2-crossref-stg.cdlib.org,dash2-stg.cdlib.org,datashare-stg.cdlib.org,oneshare-stg.cdlib.org,oneshare2-stg.cdlib.org,uc3-datashare-stg.cdlib.org

(...)

Generated 2019-02-13T16:01:42-08:00
```

#### Generate a full report in Markdown format with header and footer

```
uc3-system-info hosts uc3-inventory.txt --format md --header --footer
```

Outputs:

> | Service | Environment | Subsystem | Name | FQDN | CNAMEs |
> | :--- | :--- | :--- | :--- | :--- | :--- |
> | dash | dev |  | uc3-dash2-dev | uc3-dash2-dev.cdlib.org | dash-aws-dev.cdlib.org<br/>dash-dev.cdlib.org<br/>dash-ucla-dev.cdlib.org<br/>dash2-crossref-dev.cdlib.org<br/>dash2-dev.cdlib.org<br/>datashare-dev.cdlib.org<br/>oneshare-aws-dev.cdlib.org<br/>oneshare-dev.cdlib.org<br/>oneshare2-dev.cdlib.org<br/>uc3-datashare-dev.cdlib.org |
> | dash | dev | solr | uc3-dash2solr-dev | uc3-dash2solr-dev.cdlib.org | dash2solr-dev.cdlib.org |
> | dash | stg |  | uc3-dash2-stg | uc3-dash2-stg.cdlib.org | dash-stg.cdlib.org<br/>dash-ucla-stg.cdlib.org<br/>dash2-aws-stg.cdlib.org<br/>dash2-crossref-stg.cdlib.org<br/>dash2-stg.cdlib.org<br/>datashare-stg.cdlib.org<br/>oneshare-stg.cdlib.org<br/>oneshare2-stg.cdlib.org<br/>uc3-datashare-stg.cdlib.org |

(etc.)

#### Generate a comma-separated report on Dash hosts only, with header

```
uc3-system-info hosts uc3-inventory.txt --format csv --service dash --header
```

Outputs:

```
Environment,Subsystem,Name,FQDN,CNAMEs
dev,,uc3-dash2-dev,uc3-dash2-dev.cdlib.org,dash-aws-dev.cdlib.org;dash-dev.cdlib.org;dash-ucla-dev.cdlib.org;dash2-crossref-dev.cdlib.org;dash2-dev.cdlib.org;datashare-dev.cdlib.org;oneshare-aws-dev.cdlib.org;oneshare-dev.cdlib.org;oneshare2-dev.cdlib.org;uc3-datashare-dev.cdlib.org
dev,solr,uc3-dash2solr-dev,uc3-dash2solr-dev.cdlib.org,dash2solr-dev.cdlib.org
stg,,uc3-dash2-stg,uc3-dash2-stg.cdlib.org,dash-stg.cdlib.org;dash-ucla-stg.cdlib.org;dash2-aws-stg.cdlib.org;dash2-crossref-stg.cdlib.org;dash2-stg.cdlib.org;datashare-stg.cdlib.org;oneshare-stg.cdlib.org;oneshare2-stg.cdlib.org;uc3-datashare-stg.cdlib.org
```

(etc.)

---

## `nodes` command

### Input

The path to a clone of the [mrt-conf-prv](github.com/cdlib/mrt-conf-prv/) private repository.

### Usage

```
Usage:
  uc3-system-info nodes <path to mrt-conf-prv> [flags]

Flags:
  -f, --format string   output format (tsv, csv, md) (default "tsv")
      --header          include header
      --footer          include footer
  -h, --help            help for nodes
```

### Examples

#### Generate a list of all nodes in default TSV format, without header or footer

```
uc3-system-info nodes ~/Work/mrt-conf-prv
```

Outputs:

```
nodes-ch-ucdn.properties

7041	aws-std	dryad-assetstore-merritt-west
7042	aws-std	dryad-assetstore-merritt-stage

nodes-ch-unm.properties

7101	ch-unm-prd	8101
7301	ch-unm-dev	8101

nodes-dev-audit.properties

910	sdsc	uc3a.bucket
999	sdsc	uc3a.999
5001	aws-std	uc3-s3mrt5001-dev
6001	aws-near	uc3-s3mrt6001-dev
9001	sdsc	distrib.dev.9001.__
9503	minio-sdsc	cdl.sdsc.test
```

(etc.)

#### Generate a list of all nodes in Markdown format, with header and footer

```
uc3-system-info nodes ~/Work/mrt-conf-prv --header --footer --format md
```

Outputs:

> ### nodes-ch-ucdn.properties
> 
> | Node number | Service | Container |
> | :--- | :--- | :--- |
> | 7041 | aws-std | dryad-assetstore-merritt-west |
> | 7042 | aws-std | dryad-assetstore-merritt-stage |
> 
> ### nodes-ch-unm.properties
> 
> | Node number | Service | Container |
> | :--- | :--- | :--- |
> | 7101 | ch-unm-prd | 8101 |
> | 7301 | ch-unm-dev | 8101 |

(etc.)

---

## Building

The `uc3-system-info` project can be built and installed simply with `go
build` and `go install`, but it also supports [Mage](https://magefile.org).

To install the latest version of Mage:

1. visit their [releases page](https://github.com/magefile/mage/releases),
   download the appropriate binary, and place it in your `$PATH`, or
2. from _outside_ this project directory (`go get` behaves differently when
   run in the context of a module project), execute the following:

   ```
   go get -u -d github.com/magefile/mage \
   && cd $GOPATH/src/github.com/magefile/mage \
   && go run bootstrap.go
   ```

### Mage tasks:

| Tasks        | Purpose                                                          |
| :---         | :---                                                             |
| `build`      | builds a binary for the current platform                         |
| `buildAll`   | builds a binary for each target platform                         |
| `buildLinux` | builds a linux-amd64 binary (the most common cross-compile case) |
| `clean`      | removes compiled binaries from the current working directory     |
| `install`    | installs in $GOPATH/bin                                          |
| `platforms`  | lists target platforms for buildAll                              |

Note that `mage build` is a thin wrapper around `go build` and supports the
same environment variables, e.g. `$GOOS` and `$GOARCH`.
